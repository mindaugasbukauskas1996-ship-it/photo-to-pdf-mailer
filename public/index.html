<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Foto → PDF</title>
  <style>
    body { font-family: system-ui, Arial; margin: 20px; }
    .card { max-width: 520px; margin: 0 auto; padding: 16px; border: 1px solid #ddd; border-radius: 12px; }
    button { padding: 12px 14px; font-size: 16px; border-radius: 10px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }
    #primary { width: 100%; font-size: 18px; border: 0; background: #111; color: #fff; }
    #status { margin-top: 10px; color: #555; }
    #previewWrap { margin-top: 12px; display: none; }
    #previewBox { width: 100%; border: 1px solid #ddd; border-radius: 12px; overflow: hidden; background: #fafafa; }
    #preview { width: 100%; display: block; transform-origin: center center; }
    .muted { color: #666; font-size: 14px; margin-top: 8px; }
    .danger { color: #b00020; }

    /* NEW */
    label { display:block; font-size: 14px; color:#444; margin-top: 10px; }
    input[type="text"]{
      width:100%;
      padding: 12px 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Nuotrauka → PDF → el. paštas</h2>

    <!-- NEW: input fields -->
    <label for="accountNo">Paskyros nr.:</label>
    <input id="accountNo" type="text" placeholder="pvz. 123456" autocomplete="off" />

    <label for="address">Adresas:</label>
    <input id="address" type="text" placeholder="pvz. Gedimino pr. 15, Vilnius" autocomplete="off" />

    <input id="camera" type="file" accept="image/*" capture="environment" style="display:none" />

    <button id="primary" type="button">Fotografuoti</button>

    <div id="previewWrap">
      <div class="muted">Peržiūra (pasukite jei reikia, tada siųskite):</div>
      <div id="previewBox">
        <img id="preview" alt="preview" />
      </div>

      <div class="row">
        <button id="rotL" type="button">⟲ Pasukti kairėn</button>
        <button id="rotR" type="button">⟳ Pasukti dešinėn</button>
        <button id="send" type="button" style="border:0;background:#111;color:#fff;">Siųsti į PDF</button>
        <button id="retake" type="button">Perfotografuoti</button>
      </div>
    </div>

    <div id="status" class="muted">Įveskite paskyros nr. ir adresą, tada spauskite „Fotografuoti“.</div>
    <div class="muted">Gavėjas: mindaugas.bukauskas@manobustas.lt</div>
  </div>

<script>
  const input = document.getElementById('camera');
  const primary = document.getElementById('primary');
  const previewWrap = document.getElementById('previewWrap');
  const preview = document.getElementById('preview');
  const statusEl = document.getElementById('status');

  const rotL = document.getElementById('rotL');
  const rotR = document.getElementById('rotR');
  const sendBtn = document.getElementById('send');
  const retakeBtn = document.getElementById('retake');

  // NEW
  const accountNoEl = document.getElementById('accountNo');
  const addressEl = document.getElementById('address');

  let file = null;
  let rotation = 0; // 0, 90, 180, 270
  let objectUrl = null;

  function setStatus(msg, isError=false){
    statusEl.textContent = msg;
    statusEl.className = isError ? "muted danger" : "muted";
  }

  function updatePreviewTransform() {
    preview.style.transform = `rotate(${rotation}deg)`;
  }

  function clearPreview() {
    file = null;
    rotation = 0;
    updatePreviewTransform();
    previewWrap.style.display = "none";
    if (objectUrl) URL.revokeObjectURL(objectUrl);
    objectUrl = null;
    preview.src = "";
  }

  function setBusy(isBusy) {
    sendBtn.disabled = isBusy;
    rotL.disabled = isBusy;
    rotR.disabled = isBusy;
    retakeBtn.disabled = isBusy;
    primary.disabled = isBusy;
    accountNoEl.disabled = isBusy;
    addressEl.disabled = isBusy;
  }

  function validateMeta() {
    const accountNo = (accountNoEl.value || "").trim();
    const address = (addressEl.value || "").trim();
    if (!accountNo) return { ok:false, error:"Įveskite Paskyros nr." };
    if (!address) return {
